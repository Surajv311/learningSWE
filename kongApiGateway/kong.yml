_format_version: "3.0"

services:
  - name: internal-weather-service
    url: http://internal_weather_service_b:8900 # url: http://host.docker.internal:8900
    routes:
      - name: internal-weather-route-GET
        paths:
          - /api/getWeather/*
        methods:
          - GET
      - name: internal-weather-route-POST
        paths:
          - /api/sendWeather
        methods:
          - POST
      - name: internal-weather-route-UPDATE
        paths:
          - /api/updateWeather/*
        methods:
          - PUT
      - name: internal-weather-route-DELETE
        paths:
          - /api/deleteWeather/*
        methods:
          - DELETE
  - name: external-weather-service
    url: http://external_service_a:9900
    routes:
      - name: external-weather-route-GET
        paths:
          - /externalApi/getWeather/*
        methods:
          - GET

upstreams:
  - name: weather-upstream
    targets:
      - target: internal_weather_service_b:8900
        weight: 100
      - target: external_service_a:9900
        weight: 0  # Only fallback if internal_weather_service_b fails
    healthchecks:
      active:
        http_path: "/" # checking server health check at root endpoint, defined in backend code at intervals below
        healthy:
          interval: 180
          http_statuses: [200, 302]
          successes: 1
        unhealthy:
          interval: 120
          http_statuses: [429, 500, 503]
          tcp_failures: 3
          timeouts: 1
          http_failures: 3

